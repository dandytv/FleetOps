angular.module("eventConfigApp",["ngRoute","App.Utils","ngSanitize","ui.select","datetime"]).run(function(){}).run(function(n,t){t.tables={}}).config(function(n){var t=$("#hdUrlPrefix").val();n.when("/",{controller:"eventConfigListController",templateUrl:t+"/EventConfiguration/Tmpl?Prefix=lis&type=Index"}).when("/eventDetails/:id",{controller:"eventDetailController",templateUrl:t+"/EventConfiguration/Tmpl?Prefix=dtl&type=Index"}).when("/new",{controller:"eventDetailController",templateUrl:t+"/EventConfiguration/Tmpl?Prefix=dtl&type=Index"})}).factory("Api",function(n,t){var i=t.getRootUrl()+"/EventConfiguration",r=t.getRootUrl()+"/GlobalVariables",u=function(){return n({method:"GET",url:ApiRef})};return getFormData=function(t,r){var u=r||i;return n({method:"GET",url:u+"/FillData?"+$.param(t)})},getStates=function(t,r){var u=r||i;return n({method:"GET",url:u+"/GetStates?"+$.param(t)})},WebRefSelect=function(t,r){var u=r||i;return n({method:"GET",url:u+"/WebRefSelect?"+$.param(t)})},WebRefMaint=function(t,r){var u=r||i;return n({method:"POST",url:u+"/WebRefMaint",data:t})},WebProdGroupRefSelect=function(t,r){var u=r||i;return n({method:"GET",url:u+"/WebProdGroupRefSelect?"+$.param(t)})},WebProdRefSelect=function(t,r){var u=r||i;return n({method:"GET",url:u+"/WebProdRefSelect?"+$.param(t)})},WebProdRefMaint=function(t,r){var u=r||i;return n({method:"POST",url:u+"/WebProdRefMaint",data:t})},WebProdGroupRefMaint=function(t,r){var u=r||i;return n({method:"POST",url:u+"/WebProdGroupRefMaint",data:t})},WebRebatePlanSelect=function(t,r){var u=r||i;return n({method:"GET",url:u+"/WebRebatePlanSelect?"+$.param(t)})},WebRebatePlanMaint=function(t,r){var u=r||i;return n({method:"POST",url:u+"/WebRebatePlanMaint",data:t})},WebEventTypeSelect=function(t,u){var f=u||i;return n({method:"GET",url:r+"/FillData?"+$.param(t)})},WebEventTypeMaint=function(t,r){var u=r||i;return n({method:"POST",url:u+"/WebEventTypeMaint",data:t})},WebNtfyEventConfMaint=function(t,r){var u=r||i;return n({method:"POST",url:u+"/WebNtfyEventConfMaint",data:t})},WebNtfyEventRcptListSelect=function(t,r){var u=r||i;return n({method:"GET",url:u+"/WebNtfyEventRcptListSelect?"+$.param(t),data:t})},WebNtfEvtConfDelete=function(i){var r=$.param(i);return n({url:t.getRootUrl()+"/EventConfiguration/WebNtfEvtConfDelete?"+r,method:"GET"})},WebNtfEvtConfDelete=function(i){var r=$.param(i);return n({url:t.getRootUrl()+"/EventConfiguration/WebNtfEvtConfDelete?"+r,method:"GET"})},WebNtfEvtConfRcptDelete=function(i){var r=$.param(i);return n({url:t.getRootUrl()+"/EventConfiguration/WebNtfEvtConfRcptDelete",data:i,method:"POST"})},WebGetRefCmpyName=function(i){var r=$.param(i);return n({url:t.getRootUrl()+"/EventConfiguration/WebGetRefCmpyName?"+r,method:"GET"})},{selectData:u,getFormData:getFormData,GetStates:getStates,WebRefSelect:WebRefSelect,WebRefMaint:WebRefMaint,WebProdGroupRefSelect:WebProdGroupRefSelect,WebProdRefSelect:WebProdRefSelect,WebProdRefMaint:WebProdRefMaint,WebProdGroupRefMaint:WebProdGroupRefMaint,WebRebatePlanSelect:WebRebatePlanSelect,WebRebatePlanMaint:WebRebatePlanMaint,WebEventTypeSelect:WebEventTypeSelect,WebEventTypeMaint:WebEventTypeMaint,WebNtfyEventConfMaint:WebNtfyEventConfMaint,WebNtfyEventRcptListSelect:WebNtfyEventRcptListSelect,WebNtfEvtConfRcptDelete:WebNtfEvtConfRcptDelete,WebNtfEvtConfDelete:WebNtfEvtConfDelete,WebGetRefCmpyName:WebGetRefCmpyName}}).controller("eventConfigListController",function(n,t,i,r,u,f,e){n.Items=[];n.deleteModalOpen=!1;n.dtOptions={serverSide:!0,processing:!0,destroy:!0,scrollX:!0,id:"tblEventConfig",ajax:f.getRootUrl()+"/EventConfiguration/WebNtfyEvtConfListSelect",edit:{level:"scope",func:"indexSelected"}};n.$on("indexSelected",function(t,i){r.path("/eventDetails/"+i[0]);n.$apply()});n.WebNtfEvtConfDelete=function(){n.deleteModalOpen=!1;var i=e.getSelectedRow(f.tables[n.dtOptions.id]);i&&(e.InfoNotify(),t.WebNtfEvtConfDelete({ScheduleId:i[0]}).success(function(t){e.finalResultNotify(t);f.tables[n.dtOptions.id].fnDraw()}))};n.refresh=function(){f.tables[n.dtOptions.id].fnDraw()}}).controller("eventDetailController",function(n,t,i,r,u,f,e,o){var l;n.Items=[];var s=null,a=[],h={},c={};n.Recipients=[];n.detailModalOpen=!1;n.getClass=function(t){var i=n.Items.indexOf(t),t=t};l=[{Value:"c",Text:"Current Cycle"},{Value:"s",Text:"Set checking period"}];n.mapper=o.getEventMap();n.isNew=f.id?!1:!0;t.getFormData({PlanId:f.id}).success(function(t){n.callBack(t,!0)});n.shortDescpChanged=function(i,r){t.WebEventTypeSelect({Code:"ev",id:r}).success(function(t){n.callBack(t,!1)})};n.callBack=function(t,i){n.Items=[];n._Object=t.Model[0];i||(t.Selects.EventType=n._Selects.EventType);n._Selects=t.Selects;n._Selects.PeriodType=l;n.isNew&&(n._Object.type=t.Model[0].SelectedEventType);n._Object.SelectedScope&&(n._Object.SelectedOwner=n._Object.SelectedScope);n._Object.SelectedOccur=n._Object.MaxOccur>0?"S":"E";n.bitmapControls=[];_.each(t.Model,function(t,i){var r={MinIntVal:t.MinIntVal,MaxIntVal:t.MaxIntVal,MinMoneyVal:t.MinMoneyVal,MaxMoneyVal:t.MaxMoneyVal,MinDateVal:t.MinDateVal,MaxDateVal:t.MaxDateVal,MinTimeVal:t.MinTimeVal,MaxTimeVal:t.MaxTimeVal,VarCharVal:t.VarCharVal,PeriodType:t.PeriodType,PeriodInterval:t.PeriodInterval,BitmapAmt:t.BitmapAmt,id:i,EvtPlanDetailId:t.EvtPlanDetailId},f,u;r.SelectedOccur=r.PeriodInterval>0?"S":"C";r.BitmapAmt>0&&(f=o.findBinarySequence(r.BitmapAmt).sort(),u=[],_.each(f,function(t){var i=_.find(n.mapper,function(n){return n.id==t});i&&(i.val=r[i.type],u.push(i))}),n.bitmapControls.push(u),a=n.bitmapControls[0]);n.Items.push(r);s=r});n.WebNtfyEventRcptListSelect({PlanId:f.id})};n.selectedOccurChanged=function(t){t=="E"?(n._Object.MaxOccur="-1",n._Object.SelectedFrequency=""):n._Object.MaxOccur=""};n.intervalChanged=function(t){t=="C"&&(n.Items[n.selectedItem].PeriodInterval=0,n.Items[n.selectedItem].PeriodType="C")};n.WebNtfyEventRcptListSelect=function(i){t.WebNtfyEventRcptListSelect(i).success(function(t){_.each(t,function(t){var i={ChannelInd:t.ChannelInd,ContactName:t.ContactName,LangInd:t.LangInd,ContactNo:t.ContactNo,Id:t.Id};i.NotifyIndEmail=!1;i.NotifyIndSms=!1;(t.ChannelInd==1||n._Object.ChannelInd==3)&&(i.NotifyIndEmail=!0);(t.ChannelInd==2||t.ChannelInd==3)&&(i.NotifyIndSms=!0);n.Recipients.push(i)})})};n.containsBitmap=function(t,i){var r=n.bitmapControls[t],u=_.find(r,function(n){return n.id==i});return u?!0:!1};n.editItem=function(t){n.isItemEdit=!0;var i=n.Items.indexOf(t);n.selectedItem=i;h=$.extend({},n.Items[i]);c=$.extend({},n.bitmapControls[i]);n.detailModalOpen=!0};n.CreateNewItem=function(t){t.currentTarget.blur();n.isItemEdit=!1;var i=jQuery.extend({},s);o.makeObjectNull(i,{BitmapAmt:n.Items[n.Items.length-1].BitmapAmt,id:n.Items.length});n.Items.push(i);n.bitmapControls.push(n.bitmapControls[n.bitmapControls.length-1]);n.selectedItem=n.Items.length-1;n.detailModalOpen=!0};n.removeItem=function(t){var i=n.Items.indexOf(t);n.itemtDeleteIndex=i;n.itemDeleteModalOpen=!0};n.confirmitemDelete=function(){n.Items.splice(n.itemtDeleteIndex,1);n.bitmapControls.splice(n.itemtDeleteIndex,1);n.itemDeleteModalOpen=!1};n.finishEdit=function(){n.detailModalOpen=!1};n.cancelEdit=function(){n.isItemEdit?(n.Items[n.selectedItem]=h,n.bitmapControls[n.selectedItem]=c):(n.Items.splice(n.selectedItem,1),n.bitmapControls.splice(n.selectedItem,1));n.detailModalOpen=!1};n.toggleStatus=function(t){n._Object.SelectedStatus=t};n.updateCompanyName=function(){t.WebGetRefCmpyName({SelectedRefTo:n._Object.SelectedRefTo,RefKey:n._Object.RefKey}).success(function(t){t&&(n._Object.CompanyName=t.companyName)})};n.CreateNewRecipient=function(t){t.currentTarget.blur();n.Recipients.push({NotifyInd:null,ContactName:"",LangInd:null,ContactNo:"",NotifyIndEmail:!1,NotifyIndSms:!1,isEdit:!0,isNew:!0});n.selectedContact=n.Recipients.length-1;n.contactModalOpen=!0};n.editRecipient=function(t){t.ContactNoDuplicate=t.ContactNo;t.ContactNameDuplicate=t.ContactName;t.NotifyIndEmailDuplicate=t.NotifyIndEmail;t.NotifyIndSmsDuplicate=t.NotifyIndSms;n.selectedContact=n.Recipients.indexOf(t);n.contactModalOpen=!0};n.removeRecipient=function(t){var i=n.Recipients.indexOf(t);n.recipientDeleteIndex=i;n.contactDeleteModalOpen=!0};n.confirmremoveRecipient=function(){n.Recipients[n.recipientDeleteIndex].isNew?(n.Recipients.splice(n.recipientDeleteIndex,1),n.contactDeleteModalOpen=!1):(o.InfoNotify(),t.WebNtfEvtConfRcptDelete({SchRcptId:n.Recipients[n.recipientDeleteIndex].Id}).success(function(t){o.finalResultNotify(t);n.Recipients.splice(n.recipientDeleteIndex,1);n.contactDeleteModalOpen=!1}))};n.switchMedium=function(t,i){var r=n.Recipients[t];r.NotifyIndSms=!1;r.NotifyIndEmail=!1;i=="sms"?r.NotifyIndSms=!0:i=="email"&&(r.NotifyIndEmail=!0)};n.cancelContact=function(t){if(t.isNew){var i=n.Recipients.indexOf(t);n.Recipients.splice(i,1)}else t.ContactNo=t.ContactNoDuplicate,t.ContactName=t.ContactNameDuplicate,t.NotifyIndEmail=t.NotifyIndEmailDuplicate,t.NotifyIndSms=t.NotifyIndSmsDuplicate;n.contactModalOpen=!1};n.finishEditContact=function(t){if(!t.ContactNo||!t.ContactName||!t.LangInd)return o.PNotify({flag:1,Descp:"Please fill in all fields"});t.isEdit=!1;n.Recipients.indexOf(t).ContactNoDuplicate=null;n.contactModalOpen=!1};n.finishEdit=function(){n.detailModalOpen=!1};n.saveAll=function(){var i=n._Object,f;if(i._EventRcptList=n.Recipients,i.ProductItems=n.Items,f=0,!n.Recipients.length)return o.PNotify({flag:1,Descp:"Atleast one recipient details must be filled."});_.each(i._EventRcptList,function(n){n.NotifyIndSms?n.ChannelInd=2:n.NotifyIndEmail&&(n.ChannelInd=1)});o.InfoNotify();t.WebNtfyEventConfMaint(i).success(function(t){t.flag==0&&(n.isNew?r.path("/eventDetails/"+t.Id):u.reload());o.finalResultNotify(t)})}});
//# sourceMappingURL=EventConfiguration.min.js.map