angular.module("PukalAcctApp",["ngRoute","App.Utils","ngSanitize","ui.select"]).run(function(n,t,i,r){t.tables={};t.obj={};t.$on("updatePath",function(n,t){i.path(t)});t.$on("$routeChangeStart",function(n,i){t.$broadcast("routeChanged",i.pageKey)});t.$on("$routeChangeSuccess",function(){var n=i.path();n=="/new"?(t.obj._type="new",t.obj.corpCd=null):n=="/"?t.obj._type="index":(t.obj.corpCd=r.corpCd,t.obj._type="edit")})}).factory("Api",function(n,t){var i=t.getRootUrl()+"/PukalAcct",r=function(){return n({method:"GET",url:ApiRef})};return getFormData=function(t,r){var u=r||i,f=$.param(t);return n({method:"GET",url:u+"/FillData?"+f})},getMaintData=function(t,r){var u=r||i,f=$.param(t);return n({method:"GET",url:u+"/FillMaintData?"+f})},SaveChanges=function(t,r){return r.MultipleTxnRecord=t,n({method:"POST",url:i+"/FTWebTxnPukalPaymentMaint",data:r})},SaveSedutChanges=function(t){return n({method:"POST",url:i+"/WebPukalSedutMaint",data:t})},getWebTxnPukalPaymentSelect=function(t){return n({url:i+"/GetWebTxnPukalPaymentSelect?"+$.param(t),method:"GET"})},getPukalPaymentSummSelect=function(t,r){var u=r||i,f=$.param(t);return n({method:"GET",url:u+"/GetPukalPaymentSummSelect?"+f})},{getFormData:getFormData,getMaintData:getMaintData,getPukalPaymentSummSelect:getPukalPaymentSummSelect,getWebTxnPukalPaymentSelect:getWebTxnPukalPaymentSelect,SaveChanges:SaveChanges,SaveSedutChanges:SaveSedutChanges}}).config(function(n){var t=$("#hdUrlPrefix").val();n.when("/",{templateUrl:"index.html",controller:"indexController"}).when("/viewBatch/:batchId?",{templateUrl:t+"/PukalAcct/Tmpl?Prefix=pkal&type=Index",controller:"viewBatchController"})}).controller("indexController",function(n,t,i,r,u,f,e){n.modalOpen=!1;t.obj._type="index";t.PukalAcctInfo={};n.WebPukalSedutList={};e.getFormData({Prefix:"gen"}).success(function(t){n._Object=t.Model;n._Selects=t.Selects});n.dtOptions={serverSide:!0,processing:!0,checkBox:!1,bAutoWidth:!1,scrollX:!0,id:"tblPukalAcct",ajax:t.getRootUrl()+"/PukalAcct/ftGetPukalAcctBatchList?refCd=&AcctOfficeCd=&cycStmtId=0",aoColumnDefs:[{sClass:"text-center",aTargets:[1]},{sClass:"text-center",aTargets:[2]},{sClass:"text-right",aTargets:[3]},{sClass:"text-center",aTargets:[4]},{sClass:"text-center",aTargets:[5]}],edit:{level:"scope",func:"indexSelected"}};n.GetPukaAccountBatchList=function(){n.dtOptions={serverSide:!0,processing:!0,checkBox:!1,bAutoWidth:!1,destroy:!0,scrollX:!0,id:"tblPukalAcct",ajax:t.getRootUrl()+"/PukalAcct/ftGetPukalAcctBatchList?refCd="+n._Object.RefCd+"&acctOfficeCd= "+n._Object.AcctOfficeCd+"&cycStmtId="+n._Object.CycStmtId,aoColumnDefs:[{sClass:"text-center",aTargets:[1]},{sClass:"text-center",aTargets:[2]},{sClass:"text-right",aTargets:[3]},{sClass:"text-center",aTargets:[4]},{sClass:"text-center",aTargets:[5]}],edit:{level:"scope",func:"indexSelected"}}};n.loadPukalSedutBySelected=function(){i(function(){n.dtPukalSedutOptions={serverSide:!0,processing:!0,checkBox:!1,autoWidth:!1,destroy:!0,scrollX:!0,id:"tblPukalSedutContent",ajax:t.getRootUrl()+"/PukalAcct/ftGetPukalSedutView?"+$.param({refCd:n._Object.RefCd,acctOfficeCd:n._Object.AcctOfficeCd,Sts:"P"}),edit:{level:"scope",func:"indexPukaSedutSelected"},initComplete:function(){}}},300);i(function(){n.dtPukalSedutHistoryOptions={serverSide:!0,processing:!0,checkBox:!1,autoWidth:!1,destroy:!0,scrollX:!0,id:"tblPukalSedutHistory",ajax:t.getRootUrl()+"/PukalAcct/ftGetPukalSedutView?"+$.param({refCd:n._Object.RefCd,acctOfficeCd:n._Object.AcctOfficeCd,Sts:"C"}),edit:{level:"scope",func:"indexPukaSedutHistorySelected"},initComplete:function(){}}},300)};n.$on("indexSelected",function(i,u){n._Object.BatchId=u[0];n._Object.RefCd=u[1];n._Object.AcctOfficeCd=u[2];n._Object.ChequeNo=u[3];n._Object.ChequeAmt=u[4];n._Object.CreationDate=u[5];n._Object.StatementDate=u[6];n._Object.SelectedOwner=u[8];n._Object.SelectedTxnCd=u[1];t.PukalAcctInfo=n._Object;r.path("/viewBatch").search("batchId",n._Object.BatchId);n.$apply()});n.$on("indexPukaSedutSelected",function(t,i){n.WebPukalSedutList={AcctNo:i[0],CompanyName:i[1],ActivationDate:i[2],TerminationDate:i[3],PukalAmt:i[4],StmtDate:i[5],Status:i[6],UserId:i[7]};n.modalOpen=!0;n.$apply()});n.RefCdSelectionChanged=function(t){n._Object.RefCd=t;n.GetPukaAccountBatchList()};n.StatementDateChanged=function(t){n._Object.CycStmtId=t.split(":")[0];n._Object.StatementDate=t.split(":")[1];n.GetPukaAccountBatchList()};n.CardSelectionChanged=function(t){n._Object.AcctOfficeCd=t;n.GetPukaAccountBatchList()};n.LoadSedutContentList=function(){n._Object.SelectedRefCd="";n._Object.RefCd="";n._Object.SelectedAreaCode="";n._Object.AcctOfficeCd="";n.loadPukalSedutBySelected()};n.SedutRefCdSelectionChanged=function(t){n._Object.RefCd=t;n.loadPukalSedutBySelected()};n.SedutCardSelectionChanged=function(t){n._Object.AcctOfficeCd=t;n.loadPukalSedutBySelected()};n.refresh=function(){t.tables[n.dtOptions.id].fnDraw()};n.NewTxn=function(){if(n._Object.RefCd)if(n._Object.AcctOfficeCd)if(n._Object.CycStmtId){if(n._Object.AcctOfficeCd&&n._Object.RefCd&&n._Object.CycStmtId){n._Object.BatchId=0;n._Object.ChequeNo=0;n._Object.ChequeAmt=0;var i=new Date;n._Object.CreationDate=i.getDate()+"/"+(i.getMonth()+1)+"/"+i.getFullYear();n._Object.StatementDate=n._Object.StatementDate;n._Object.SelectedOwner="";t.PukalAcctInfo=n._Object;r.path("/viewBatch").search("batchId",n._Object.BatchId)}}else new PNotify({text:"Please select a statement date",addclass:"stack-bottomright",stack:{dir1:"up",dir2:"left",firstpos1:25,firstpos2:25},type:"error",styling:"fontawesome"});else new PNotify({text:"Please select a Area Code",addclass:"stack-bottomright",stack:{dir1:"up",dir2:"left",firstpos1:25,firstpos2:25},type:"error",styling:"fontawesome"});else new PNotify({text:"Please select a Reference Code",addclass:"stack-bottomright",stack:{dir1:"up",dir2:"left",firstpos1:25,firstpos2:25},type:"error",styling:"fontawesome"})};n.SaveSedutChanges=function(){u.InfoNotify();e.SaveSedutChanges(n.WebPukalSedutList).success(function(i){u.finalResultNotify(i.result);t.tables[n.dtPukalSedutOptions.id].fnDraw()});n.modalOpen=!1}}).controller("viewBatchController",function(n,t,i,r,u,f){t.obj._type="index";n.batchId=0;n.Items=[];n.Total=0;n.ChequeAmtDiffer=0;n.ChequeNo=0;n.ChequeAmt=0;n.Owner="";n.Difference=n.ChequeAmt-n.Total;n.StatementDate="";n.CycStmtId="";n.RefCd=angular.isUndefined(t.PukalAcctInfo)?"":t.PukalAcctInfo.RefCd;n.AcctOfficeCd=angular.isUndefined(t.PukalAcctInfo)?"":t.PukalAcctInfo.AcctOfficeCd;angular.isUndefined(t.PukalAcctInfo)?(n.StatementDate="",n.CycStmtId=0):(n.CycStmtId=t.PukalAcctInfo.CycStmtId,n.StatementDate=t.PukalAcctInfo.StatementDate.replace(/-/g,"/"));u.getMaintData({batchId:i.batchId,StatementDate:n.StatementDate}).success(function(t){n._Object=t.Model;n._Selects=t.Selects;i.batchId!=0?(n.RefCd=t.Model.RefCd,n.AcctOfficeCd=t.Model.AcctOfficeCd,n.StatementDate=t.Model.StmtDate,n.CycStmtId=t.Model.CycStmtId):(n._Object.RefCd=n.RefCd,n._Object.CycStmtId=n.CycStmtId,n._Object.AcctOfficeCd=n.AcctOfficeCd);n.batchId=i.batchId;n.ChequeNo=t.Model.ChequeNo;n.ChequeAmt=t.Model.ChequeAmt;n.ChequeAmtDiffer=t.Model.ChequeAmt;n.CreationDate=t.Model.TxnDate;n.Owner=t.Model.Owner;n.Difference=n.ChequeAmt-n.Total;u.getWebTxnPukalPaymentSelect({batchId:i.batchId,refCd:n.RefCd,acctOfficeCd:n.AcctOfficeCd,cycStmtId:n.CycStmtId}).success(function(t){n.Items=t.list;e();n.$watch("ChequeAmtDiffer",function(t){t.toString().indexOf(",")!=-1?(n.ChequeAmtDiffer=t.replace(/,/,""),e(t)):e(t)},!0);n.Items.length&&angular.isUndefined(n._Object.SelectedTxnCd)&&(n._Object.SelectedTxnCd=n.Items[0].TxnCd)})});n.isEdit=!0;n.ChangeChequeAmt=function(t){n.ChequeAmtDiffer=t;n.ChequeAmtDiffer=t.replace(/,/,"");e(n.ChequeAmtDiffer)};n.ChequeNoNumber=function(n){return n.length>11||n.length==0?!1:event.which==64||event.which==16?!1:event.which>=48&&event.which<=57?!0:event.which>=96&&event.which<=105?!0:[8,13,27,37,38,39,40].indexOf(event.which)>-1?!0:(event.preventDefault(),!1)};t.SaveChanges=function(){f.InfoNotify();n.Difference<0&&(n._Object.MultipleTxnRecord={});o(n._Object)&&u.SaveChanges(n.Items,n._Object).success(function(t){f.finalResultNotify(t.result);t.result.flag==0&&(n._Object.BatchId==0?(r.path("/viewBatch").search("batchId",t.result.Id),setTimeout(function(){window.location.reload()},1500)):(r.path("/viewBatch").search("batchId",n._Object.BatchId),setTimeout(function(){window.location.reload()},1500)))})};n.ApplyChanges=function(t,i){if(n.Items.length>0)for(var r=0;r<n.Items.length;r++)n.Items[r].AcctNo==t&&i.trim()==""&&(n.Items[r].PaymentAmt=0)};var o=function(t){var i=!0;return t.SelectedTxnCd==""?(n.result={flag:1,desp:"Txt Code is a compulsory field",Id:null},f.finalResultNotify(n.result),i=!1):t.CreationDate==""?(n.result={flag:1,desp:"Txt Date is a compulsory field",Id:null},f.finalResultNotify(n.result),i=!1):t.SelectedOwner==""&&t.Func=="Submit"?(n.result={flag:1,desp:"Owner is a compulsory field",Id:null},f.finalResultNotify(n.result),i=!1):(t.ChequeNo+"").length>=11||t.ChequeNo=="0"?(n.result={flag:1,desp:"Cheque No to only allow to accept 10 digits",Id:null},f.finalResultNotify(n.result),i=!1):t.SelectedSettlement==""&&(n.result={flag:1,desp:"GL Settlementis a compulsory field",Id:null},f.finalResultNotify(n.result),i=!1),i},e=function(){var n=s();h(n)},s=function(){return _.map(n.Items,function(n){var i,t;return n.PaymentAmt?(i=n.PaymentAmt.toString(),t=Number(i.replace(/[^0-9\.]+/g,"")),parseFloat(t)):n.PaymentAmt==""?(n.PaymentAmt="0.00",0):0})},h=function(t){var i=t.reduce(function(n,t){return n+t},0);n.Total=parseFloat(i||0).toFixed(2)||0;n.Difference=n._Object?(parseFloat(n.ChequeAmtDiffer||0)-n.Total).toFixed(2):parseFloat(0-(n.Total||0)).toFixed(2)};n.$watch("Items",function(n){e(n)},!0)}).directive("limitTo",[function(){return{restrict:"A",link:function(n,t,i){var r=parseInt(i.limitTo);angular.element(t).on("keypress",function(n){this.value.length==r&&n.preventDefault()})}}}]).directive("validInput",function(){return{require:"?ngModel",scope:{inputPattern:"@"},link:function(n,t,i,r){var u=null;(n.inputPattern!==undefined&&(u=new RegExp(n.inputPattern,"g")),r)&&(r.$parsers.push(function(n){if(u){var t=n.replace(u,"");return n!==t&&(r.$setViewValue(t),r.$render()),t}return n}),t.bind("keypress",function(n){n.keyCode===32&&n.preventDefault()}))}}});
//# sourceMappingURL=pukalAcct.min.js.map